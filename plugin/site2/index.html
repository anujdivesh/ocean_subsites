<html>
    <head>
        <title>Site 2 - Images Gallery</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 40px;
                background-color: #f5f5f5;
            }
            .container {
                max-width: 800px;
                margin: 0 auto;
                background: white;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            h1 {
                color: #333;
                border-bottom: 2px solid #007acc;
                padding-bottom: 10px;
            }
            .image-list {
                list-style: none;
                padding: 0;
            }
            .image-item {
                margin: 20px 0;
                padding: 15px;
                background: #f9f9f9;
                border-radius: 5px;
                border-left: 4px solid #007acc;
            }
            .image-item a {
                text-decoration: none;
                color: #007acc;
                font-weight: bold;
                font-size: 18px;
            }
            .image-item a:hover {
                color: #005a99;
            }
            .image-preview {
                margin-top: 10px;
                max-width: 200px;
                height: auto;
                border: 1px solid #ddd;
                border-radius: 4px;
            }
            .description {
                color: #666;
                margin-top: 5px;
                font-style: italic;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Site 2 - Images Gallery</h1>
            <p>Available images in the directory:</p>
            
         
            
            <hr style="margin: 30px 0;">
            
            <h3>Direct Image URLs:</h3>
            <ul id="imageUrls">
                <!-- URLs will be populated by JavaScript -->
            </ul>
        </div>

        <script>
            // Function to automatically generate image URLs
            async function loadImageUrls() {
                const imageContainer = document.getElementById('imageUrls');
                const baseUrl = `${window.location.protocol}//${window.location.host}${window.location.pathname.replace('/index.html', '').replace(/\/$/, '')}/images/`;

                // Clear existing content
                imageContainer.innerHTML = '';

                try {
                    // Fetch Nginx autoindex HTML for the images directory
                    const response = await fetch(baseUrl, { headers: { 'Accept': 'text/html' } });
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);

                    const html = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');

                    const exts = new Set(['png', 'jpg', 'jpeg', 'gif', 'svg', 'webp']);
                    const links = Array.from(doc.querySelectorAll('a'))
                        .map(a => a.getAttribute('href') || '')
                        .filter(href => href && href !== '../' && !href.endsWith('/'));

                    const imageUrls = links
                        .map(href => new URL(href, baseUrl).href)
                        .filter(url => exts.has((url.split('.').pop() || '').toLowerCase()));

                    if (imageUrls.length === 0) {
                        const li = document.createElement('li');
                        li.innerHTML = '<em>No images found in directory</em>';
                        li.style.color = '#666';
                        imageContainer.appendChild(li);
                        return;
                    }

                    for (const imageUrl of imageUrls) {
                        const li = document.createElement('li');
                        const code = document.createElement('code');
                        code.textContent = imageUrl;
                        li.appendChild(code);
                        imageContainer.appendChild(li);
                    }
                } catch (e) {
                    // Fallback: try known filenames if autoindex is not available
                    console.error('Failed to load autoindex; falling back to known list', e);
                    const fallbackFiles = ['experts.png', 'realtime.png', 'niue-forecast.png'];
                    for (const filename of fallbackFiles) {
                        const imageUrl = baseUrl + filename;
                        const img = new Image();
                        img.onload = function() {
                            const li = document.createElement('li');
                            const code = document.createElement('code');
                            code.textContent = imageUrl;
                            li.appendChild(code);
                            imageContainer.appendChild(li);
                        };
                        img.src = imageUrl;
                    }
                    setTimeout(() => {
                        if (imageContainer.children.length === 0) {
                            const li = document.createElement('li');
                            li.innerHTML = '<em>No images found in directory</em>';
                            li.style.color = '#666';
                            imageContainer.appendChild(li);
                        }
                    }, 2000);
                }
            }
            
            // Alternative function that dynamically discovers images by trying common extensions
            async function discoverImages() {
                const imageContainer = document.getElementById('imageUrls');
                const baseUrl = `${window.location.protocol}//${window.location.host}${window.location.pathname.replace('/index.html', '').replace(/\/$/, '')}/images/`;
                
                // Common image extensions to check
                const extensions = ['png', 'jpg', 'jpeg', 'gif', 'svg', 'webp'];
                
                // Common image names to check (you can add more)
                const commonNames = [
                    'realtime', 'niue-forecast', 'forecast', 'monitoring', 'ocean',
                    'wave', 'tide', 'buoy', 'station', 'chart', 'graph', 'data',
                    'image1', 'image2', 'image3', 'screenshot', 'preview'
                ];
                
                const foundImages = [];
                let checked = 0;
                const totalChecks = commonNames.length * extensions.length;
                
                commonNames.forEach(name => {
                    extensions.forEach(ext => {
                        const filename = `${name}.${ext}`;
                        const imageUrl = baseUrl + filename;
                        
                        const img = new Image();
                        img.onload = function() {
                            if (!foundImages.includes(imageUrl)) {
                                foundImages.push(imageUrl);
                                const li = document.createElement('li');
                                const code = document.createElement('code');
                                code.textContent = imageUrl;
                                li.appendChild(code);
                                imageContainer.appendChild(li);
                            }
                        };
                        img.onerror = function() {
                            // Image doesn't exist, ignore
                        };
                        img.onload = img.onerror = function() {
                            checked++;
                            if (checked === totalChecks && foundImages.length === 0) {
                                const li = document.createElement('li');
                                li.innerHTML = '<em>No images found in directory</em>';
                                li.style.color = '#666';
                                imageContainer.appendChild(li);
                            }
                        };
                        img.src = imageUrl;
                    });
                });
            }
            
            // Run when page loads
            document.addEventListener('DOMContentLoaded', function() {
                loadImageUrls();
            });
        </script>
    </body>
</html>